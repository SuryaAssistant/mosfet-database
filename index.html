<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="Mosfet database" name="description">
        <meta content="mosfet, database, mosfets" name="keywords">

        <title>Mosfet Database</title>
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

        <!-- CSS -->
        <link href="./assets/css/index.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

        <!-- Boxicon -->
        <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    </head>
    <body>
        <!-- Navbar -->
        <nav class="navbar sticky-top bg-body-tertiary pure-white-background">
            <div class="container-fluid">
                <div class="col">
                    <a class="navbar-brand" href=""><Strong>Mosfet Database</Strong></a>
                </div>
                <div class="col" style="text-align: right;">
                    <a href="https://docs.google.com/forms/d/e/1FAIpQLSemChTOIrG7bC3fkWSs0DgiqArsukzqh1s5NM-EwwNWEtRayQ/viewform?usp=sharing">
                        <button type="button" class="btn btn-primary">Request Mosfet</button>
                    </a>
                </div>
            </div>
        </nav>

        <div class="sidebar">
            <a id="btn-menu-0" class="active" href="#" onclick="menu(0)"><i class='bx bxs-data menu-icon'></i> Database</a>
            <a id="btn-menu-1" href="#" onclick="menu(1)"><i class='bx bxs-calculator menu-icon'></i> Switching Calculator</a>
            <a id="btn-menu-2" href="#" onclick="menu(2)"><i class='bx bxs-calculator menu-icon'></i> Bootstrap Calculator</a>
            <a id="btn-menu-3" href="#" onclick="menu(3)"><i class='bx bxs-calculator menu-icon'></i> Snubber Calculator</a>
        </div>


        <section class="d-flex flex-column" style="padding-bottom:0px;">
            <div class="content">
            <div class="row" style="margin:0px; margin-top:20px">

                <!-- Content Field -->
                    <!-- Database -->
                    <div class="row" id="mosfet-database" style="overflow-y: auto; margin:0px; display:block">
                        <div class="container">
                            <div class="col">
                                <!--
                                <h4 style=>Filter</h4>
                                <div class="row y-scroll">
                                    <div class="card text-bg-primary mb-3 card-filter" style="max-width: 9rem;">
                                        <div class="card-header">Search</div>
                                        <div class="card-body">
                                            <p class="card-text">abc</p>
                                        </div>
                                    </div>
                                    <div class="card text-bg-primary mb-3 card-filter" style="max-width: 9rem;">
                                        <div class="card-header">Search</div>
                                        <div class="card-body">
                                            <p class="card-text">abc</p>
                                        </div>
                                    </div>
                                    <div class="card text-bg-primary mb-3 card-filter" style="max-width: 9rem;">
                                        <div class="card-header">Search</div>
                                        <div class="card-body">
                                            <p class="card-text">abc</p>
                                        </div>
                                    </div>
                                    <div class="card text-bg-primary mb-3 card-filter" style="max-width: 9rem;">
                                        <div class="card-header">Search</div>
                                        <div class="card-body">
                                            <p class="card-text">abc</p>
                                        </div>
                                    </div>
                                    <div class="card text-bg-primary mb-3 card-filter" style="max-width: 9rem;">
                                        <div class="card-header">Search</div>
                                        <div class="card-body">
                                            <p class="card-text">abc</p>
                                        </div>
                                    </div>
                                    <div class="card text-bg-primary mb-3 card-filter" style="max-width: 9rem;">
                                        <div class="card-header">Search</div>
                                        <div class="card-body">
                                            <p class="card-text">abc</p>
                                        </div>
                                    </div>
                                    <div class="card text-bg-primary mb-3 card-filter" style="max-width: 9rem;">
                                        <div class="card-header">Search</div>
                                        <div class="card-body">
                                            <p class="card-text">abc</p>
                                        </div>
                                    </div>
                                    <div class="card text-bg-primary mb-3 card-filter" style="max-width: 9rem;">
                                        <div class="card-header">Search</div>
                                        <div class="card-body">
                                            <p class="card-text">abc</p>
                                        </div>
                                    </div>
                                    <div class="card text-bg-primary mb-3 card-filter" style="max-width: 9rem;">
                                        <div class="card-header">Search</div>
                                        <div class="card-body">
                                            <p class="card-text">abc</p>
                                        </div>
                                    </div>
                                    <div class="card text-bg-primary mb-3 card-filter" style="max-width: 9rem;">
                                        <div class="card-header">Search</div>
                                        <div class="card-body">
                                            <p class="card-text">abc</p>
                                        </div>
                                    </div>
                                    <div class="card text-bg-primary mb-3 card-filter" style="max-width: 9rem;">
                                        <div class="card-header">Search</div>
                                        <div class="card-body">
                                            <p class="card-text">abc</p>
                                        </div>
                                    </div>
                                    <div class="card text-bg-primary mb-3 card-filter" style="max-width: 9rem;">
                                        <div class="card-header">Search</div>
                                        <div class="card-body">
                                            <p class="card-text">abc</p>
                                        </div>
                                    </div>
                                </div>
                                -->

                                <div class="row">
                                    <div class="col">
                                        <div class="input-group" style="margin-top: 20px; max-width: 300px;">
                                            <input type="text" class="form-control param" placeholder="Search MOSFET" id="search-mosfet-input">
                                            <button class="btn btn-primary param" onclick="searchMosfet()">Search</button>
                                        </div>
                                        <span style="font-size: 12px;">Result : </span><span id="result-total-searched-mosfet" style="font-size: 12px;"></span>
                                    </div>
                                </div>
                                <div class="row y-scroll">
                                    <table class="table table-hover" style="font-size: 12px;">
                                        <thead>
                                            <tr>
                                            <th scope="col" style="width: 20px !important;" ></th>
                                            <th scope="col" style="width: 140px !important">MFR Part#</th>
                                            <th scope="col" style="width: 20px !important;"></th>
                                            <th scope="col" style="width: 200px !important">Manufacturer</th>
                                            <th scope="col" >Type</th>
                                            <th scope="col" >Package</th>
                                            <th scope="col" >VDS (V)</th>
                                            <th scope="col" >IDS (V)</th>
                                            <th scope="col" >R (mÎ©)</th>
                                            <th scope="col" >Crss (pF)</th>
                                            <th scope="col" >Coss (pF)</th>
                                            <th scope="col" >Qg (nC)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="mosfet-table">
                                        </tbody>
                                    </table>
                                </div>

                                <div class="row" style="text-align:center; padding-bottom: 10px;">
                                    <div class="col">
                                        <button type="button" class="btn btn-light" style="color: #0563bb !important" onclick="page('prev')"><i class='bx bx-chevron-left' ></i></button>
                                        <button type="button" class="btn btn-primary" id="page-number">1</button>
                                        <button type="button" class="btn btn-light" style="color: #0563bb !important" onclick="page('next')"><i class='bx bx-chevron-right'></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row" id="switching-calculator" style="overflow-y: auto; margin:0px; display:none">
                        <div class="container">
                            <div class="col">
                                <h4 style="margin-bottom:20px">Mosfet Switching Calculator</h4>
                                <h5>Input Parameter</h5>

                                <div class="row">
                                    <div class="col">
                                        <span class="param">Input Voltage / VDS (V)</span>
                                    </div>
                                    <div class="col">
                                        <input type="number" id="input-bus-voltage" class="form-control param">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col">
                                        <span class="param">Output Current / ID (A)</span>
                                    </div>
                                    <div class="col">
                                        <input type="number" id="input-output-current" class="form-control param">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col">
                                        <span class="param">Duty Cycle (%)</span>
                                    </div>
                                    <div class="col">
                                        <input type="number" id="input-duty-cycle" class="form-control param">
                                    </div>
                                </div>

                                <h5>Switching Parameter</h5>
                                <div class="row">
                                    <div class="col">
                                        <span class="param">Gate-Source Voltage / Vgs (V)</span>
                                    </div>
                                    <div class="col">
                                        <input type="number" id="input-vgs" class="form-control param">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col">
                                        <span class="param">Switching Frequency / f (Hz)</span>
                                    </div>
                                    <div class="col">
                                        <input type="number" id="input-switching-frequency" class="form-control param">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col">
                                        <span class="param">Rise-time / Tr (nanosec) </span>
                                    </div>
                                    <div class="col">
                                        <input type="number" id="input-rise-time" class="form-control param">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col">
                                        <span class="param">Fall-time / Tf (nanosec) </span>
                                    </div>
                                    <div class="col">
                                        <input type="number" id="input-fall-time" class="form-control param">
                                    </div>
                                </div>

                                <div class="row" style="text-align: right; margin-top: 10px;">
                                    <div class="col">
                                        <button type="button" class="btn btn-primary" onclick="calculateLoss()">Calculate</button>
                                    </div>
                                </div>

                                
                                <div class="row">
                                    <div class="col">
                                        <div class="row" style="height: 300px;">
                                            <div class="col" style="width:100%">
                                                <canvas id="loss-chart" width="100%" height="100%"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="row" id="result-field">
                                </div>
                                
                            </div>
                        </div>
                    </div>

                    <!-- Bootstrap Calculation -->
                    <div class="row" id="bootstrap-calculator" style="overflow-y: auto; margin:0px; display:none">
                        <div class="container">
                            <div class="col">
                            </div>
                        </div>
                    </div>

                    <!-- Snubber Calculation -->
                    <div class="row" id="snubber-calculator" style="overflow-y: auto; margin:0px; display:none">
                        <div class="container">
                            <div class="col">
                            </div>
                        </div>
                    </div>

            </div>
        </div>
        </section>

        <!-- Chart js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <!-- Bootstrap script -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

        <!-- User script -->
        <script>
            var tempoStorage = [];
            var mosfetTree = [];
            var database = [];
            var searchedDatabase = [];
            var isSearched = false;
            var databaseDisplay = [];

            var displaySize = 10;
            var mosfetTreeLength = 0;
            var prevListRow = -1;
            var userPage = 1;
            var pageMax = 1;

            async function fetchJson(filePath) {
                try {
                    const response = await fetch(filePath);
                    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                    const newJsonData = await response.json(); // Fetch the new JSON data
                    tempoStorage = newJsonData;
                } catch (error) {
                    console.error('Error fetching JSON:', error);
                }
            }

            function fillMosfetTable(startNumber){
                // fill the display
                const tableElement = document.getElementById('mosfet-table')
                tableElement.innerHTML = ``;
                for(let i=0; i<displaySize; i++){
                    if(startNumber + i >= searchedDatabase.length){return;}
                    tableElement.innerHTML += `
                        <tr>
                            <td><input class="form-check-input me-1" type="checkbox" id="check-${startNumber+i}" onClick="checkboxMosfet(${startNumber+i})" ${searchedDatabase[startNumber + i].isChecked ? "checked" : ""}></td>
                            <td onclick="openMosfetDetails(${startNumber}, ${startNumber+i})">${searchedDatabase[startNumber+i].name}</td>
                            <td ><a href="${searchedDatabase[startNumber+i].datasheet}" target="_blank" rel="noopener noreferrer"><i class='bx bxs-file-pdf'></i></a></td>
                            <td onclick="openMosfetDetails(${startNumber}, ${startNumber+i})">${searchedDatabase[startNumber+i].manufacture}</td>
                            <td onclick="openMosfetDetails(${startNumber}, ${startNumber+i})">${searchedDatabase[startNumber+i].type}</td>
                            <td onclick="openMosfetDetails(${startNumber}, ${startNumber+i})">${searchedDatabase[startNumber+i].package}</td>
                            <td onclick="openMosfetDetails(${startNumber}, ${startNumber+i})">${searchedDatabase[startNumber+i].vds}</td>
                            <td onclick="openMosfetDetails(${startNumber}, ${startNumber+i})">${searchedDatabase[startNumber+i].ids}</td>
                            <td onclick="openMosfetDetails(${startNumber}, ${startNumber+i})">${searchedDatabase[startNumber+i].rds_typ}</td>
                            <td onclick="openMosfetDetails(${startNumber}, ${startNumber+i})">${searchedDatabase[startNumber+i].crss}</td>
                            <td onclick="openMosfetDetails(${startNumber}, ${startNumber+i})">${searchedDatabase[startNumber+i].coss}</td>
                            <td onclick="openMosfetDetails(${startNumber}, ${startNumber+i})">${searchedDatabase[startNumber+i].Qg}</td>
                        </tr>
                    `;

                    tableElement.innerHTML += `
                        <tr id="mosfet-details-${startNumber+i}" style="display:none">
                            <td colspan="12" id="mosfet-details-${startNumber+i}-p"></td>
                        </tr>
                    `;

                }

                // fill searcher result count
                document.getElementById('result-total-searched-mosfet').innerText = searchedDatabase.length;
            }

            function openMosfetDetails(startNumber, number){
                for(let i=0; i<displaySize; i++){
                    if(startNumber + i >= searchedDatabase.length){continue;}

                    let id = "mosfet-details-"+String(startNumber+i);
                    let detailElement = document.getElementById(id);
                    detailElement.style.display = "none";
                }

                if(prevListRow == number){
                    prevListRow = -1;
                    return;
                }

                let id = "mosfet-details-"+String(number);
                let detailElement = document.getElementById(id);
                detailElement.style.display = "contents";

                const detailsPElement = document.getElementById('mosfet-details-'+String(number)+'-p');
                let keys = [];
                Object.keys(searchedDatabase[number]).forEach((key) => keys.push(key));

                detailsPElement.innerHTML = ``;
                for(let j=0; j<keys.length; j++){
                    detailsPElement.innerHTML += `<span>${keys[j]} : ${searchedDatabase[number][keys[j]]}</span><br/>`;
                }

                prevListRow = number;
            }

            function page(move){
                if(move == "next"){
                    pageMax = Math.floor(searchedDatabase.length / displaySize) + 1;
                    if(userPage < pageMax){userPage += 1;}
                }
                else{
                    if(userPage > 1){userPage -= 1;}
                }

                // update page number
                document.getElementById('page-number').textContent = userPage;

                // update mosfet table
                let startNumber = userPage * displaySize - displaySize;
                fillMosfetTable(startNumber);
            }

            function checkboxMosfet(number){
                let isElementChecked = document.getElementById('check-'+String(number)).checked;
                if(database[number].isChecked != isElementChecked){
                    database[number].isChecked = isElementChecked;
                }
            }


            function searchMosfet(){
                isSearched = true;
                let searchElement = document.getElementById('search-mosfet-input');
                let searchedMosfet = searchElement.value;

                searchedDatabase = []
                for(let i=0; i<database.length; i++){
                    if(database[i].name.toLowerCase().includes(searchedMosfet.toLowerCase()) 
                        || database[i].manufacture.toLowerCase().includes(searchedMosfet.toLowerCase())
                        || database[i].type.toLowerCase().includes(searchedMosfet.toLowerCase())
                        || database[i].package.toLowerCase().includes(searchedMosfet.toLowerCase())){
                        searchedDatabase.push(database[i]);
                    }
                    else{continue;}
                }

                // display
                userPage = 1;
                document.getElementById('page-number').textContent = userPage;
                fillMosfetTable(0);
                // fill searcher result count
                document.getElementById('result-total-searched-mosfet').innerText = searchedDatabase.length;
            }


            // Wait for the window to be fully loaded
            window.onload = () => {
                fetchJson('./mosfet-tree.json') // Replace with your actual JSON URL
                .then(() => {
                    for(let i=0; i<displaySize; i++){
                        databaseDisplay.push({});
                    }

                    mosfetTree.push(tempoStorage);
                    tempoStorage = [];

                    let treeLength = mosfetTree[0].length;
                    mosfetTreeLength = treeLength;

                    for(let i=0; i<treeLength; i++){
                        database.push({});
                    }

                    for(let i=0; i<treeLength; i++){
                        let paramLoc = mosfetTree[0][i].parent + mosfetTree[0][i].name + '.json';
                        fetchJson(paramLoc)
                        .then(() => {
                            database[i] = tempoStorage;
                            database[i].isChecked = false;
                            tempoStorage = [];

                            if(i == displaySize-1){
                                searchedDatabase = [];
                                searchedDatabase = database;
                                fillMosfetTable(0);
                            }
                        })
                        .catch(error => {
                            console.log('Error in fetch param', error);
                        });
                    }

                })
                .catch(error => {
                    console.error('Error in fetchJson:', error);
                });

            };
        
        </script>
        <script src="./assets/js/menu.js"></script>
        <script src="./assets/js/calculator.js"></script>

    </body>
</html>